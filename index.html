<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Smart OS (Fixed)</title>
    <style>
        /* --- 1. CORE SYSTEM --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { 
            width: 100%; height: 100%; 
            overflow: hidden; 
            background-color: #000; /* Default Black */
            font-family: sans-serif; 
        }

        /* --- 2. WALLPAPER ENGINE (FIXED LAYERS) --- */
        #wallpaper-engine {
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            z-index: 1; /* FIXED: Now visible above body */
        }

        .smart-bg {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0; 
            transition: opacity 0.5s ease;
            display: none; /* Hide by default */
        }

        .active-bg { 
            opacity: 1; 
            display: block; /* Show only when active */
        }

        /* --- 3. UI LAYER (On Top) --- */
        #settings-trigger {
            position: absolute;
            right: 20px; top: 20px;
            width: 45px; height: 45px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            z-index: 100; /* FIXED: Always on top */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .gear-icon { width: 22px; height: 22px; fill: #fff; }
        #file-picker { display: none; }

        /* Notification Toast */
        #toast {
            position: fixed; bottom: 40px; left: 50%; 
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85); color: white; 
            padding: 12px 24px; border-radius: 30px; 
            font-size: 14px; opacity: 0; 
            pointer-events: none; transition: opacity 0.3s; 
            z-index: 200; border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <div id="wallpaper-engine">
        <img id="bg-img" class="smart-bg" src="" alt="">
        <video id="bg-vid" class="smart-bg" loop muted playsinline></video>
    </div>

    <button id="settings-trigger">
        <svg class="gear-icon" viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.49l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </button>
    
    <input type="file" id="file-picker" accept="image/*,video/*">
    <div id="toast">Ready</div>

    <script>
        const btn = document.getElementById('settings-trigger');
        const picker = document.getElementById('file-picker');
        const imgEl = document.getElementById('bg-img');
        const vidEl = document.getElementById('bg-vid');
        const toastEl = document.getElementById('toast');

        // Open Gallery
        btn.addEventListener('click', () => picker.click());

        // File Selected
        picker.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                showToast("â³ Loading media...");
                
                // Use FileReader (More reliable for Gallery selection)
                const reader = new FileReader();

                reader.onload = function(e) {
                    const src = e.target.result;

                    // --- VIDEO ENGINE ---
                    if (file.type.startsWith('video/')) {
                        // 3.5 MB Limit
                        if (file.size > 3.5 * 1024 * 1024) {
                            showToast("âŒ Video too big! (Max 3.5MB)");
                            return;
                        }
                        
                        imgEl.classList.remove('active-bg');
                        vidEl.src = src;
                        vidEl.onloadeddata = () => {
                            vidEl.classList.add('active-bg');
                            vidEl.play().catch(() => showToast("Tap screen to play video"));
                            showToast("ðŸŽ¬ Live Wallpaper Set");
                        };
                    } 
                    // --- IMAGE ENGINE ---
                    else if (file.type.startsWith('image/')) {
                        vidEl.classList.remove('active-bg');
                        vidEl.pause();
                        
                        imgEl.src = src;
                        imgEl.onload = () => {
                            imgEl.classList.add('active-bg');
                            showToast("ðŸ–¼ï¸ Wallpaper Set");
                        };
                    }
                };

                reader.readAsDataURL(file); // Start reading
            }
        });

        function showToast(msg) {
            toastEl.textContent = msg;
            toastEl.style.opacity = '1';
            setTimeout(() => toastEl.style.opacity = '0', 3000);
        }
    </script>
</body>
</html>
